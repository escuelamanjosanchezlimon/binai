<div class="titulo-container">
  <h2 (click)="  mostrarResumenFinanzas()" style="margin: 15px;">Finanzas</h2>
  <div>
  </div>
  <div  style="margin-bottom: 15px !important; font-size: 15px">
    Saldo total: ₡{{ totalIngresos() }}
  </div>
</div>



<div class="form-row" [formGroup]="form">
  <mat-form-field class="full-width">
    <mat-label>Descripción</mat-label>
    <input formControlName="descripcion" matInput placeholder="Descripción breve..." />
  </mat-form-field>

  <mat-form-field>
    <mat-label>Tipo </mat-label>
    <mat-select formControlName="tipo">
      @for (tipo of tipos; track tipo) {
      <mat-option [value]="tipo.id">
        {{ tipo.label }}
      </mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field class="full-width">
    <mat-label>Monto</mat-label>
    <input formControlName="monto" type="number" matInput />
  </mat-form-field>
</div>

<div class="button-container">
  @if(modo === 'ACTUALIZAR'){

  <button (click)="eliminar()" class="button-delete" mat-icon-button>
    <mat-icon>delete</mat-icon>
  </button>

  <button (click)="cancelar()" class="button-cancel" mat-button>Cancelar</button>
  <button [disabled]="form.invalid" (click)="actualizarFinanza()" class="button-add" mat-button>
    <mat-icon>add</mat-icon>
    ACTUALIZAR
  </button>
  }@else{
  <button [disabled]="form.invalid" (click)="registrarFinanza()" class="button-add" mat-button>
    <mat-icon>add</mat-icon>AGREGAR
  </button>
  }
</div>

<div class="tabla-container">
  <mat-chip-listbox aria-label="Selección">
    <mat-chip-option (click)="filtrarFinanzas()" class="chip-filtro">
      Recientes (20)
    </mat-chip-option>
    <mat-chip-option (click)="filtrarFinanzasEsteMes()" class="chip-filtro">
      Este mes
    </mat-chip-option>

    <mat-chip-option (click)="filtrarFinanzasPorTipo(3)" class="chip-filtro">
      Deudas
    </mat-chip-option>

    <mat-chip-option (click)="filtrarFinanzasPorTipo(4)" class="chip-filtro">
      Préstamos
    </mat-chip-option>

    
    <mat-chip-option (click)="filtrarFinanzasPorTipo(5)" class="chip-filtro">
      Proyectos
    </mat-chip-option>
  </mat-chip-listbox>
  <table class="tabla-finanzas" mat-table [dataSource]="dataSource">
    <!-- Tipo -->
    <ng-container matColumnDef="tipo">
      <th mat-header-cell *matHeaderCellDef>Tipo</th>
      <td
        style="font-weight: bold"
        mat-cell
        *matCellDef="let element"
        [ngClass]="'tipo-' + element.tipo"
      >
        {{ getTipoLabel(element.tipo) }}
      </td>
    </ng-container>

    <!-- Descripción -->
    <ng-container matColumnDef="descripcion">
      <th mat-header-cell *matHeaderCellDef>Descripción</th>
      <td mat-cell *matCellDef="let element">
        {{ element.descripcion }}
      </td>
    </ng-container>

    <!-- Monto -->
    <ng-container matColumnDef="monto">
      <th mat-header-cell *matHeaderCellDef>Monto</th>
      <td mat-cell *matCellDef="let element">
        <span [ngClass]="getMontoClass(element.tipo)">
          {{ getMontoSign(element.tipo) }}
          {{ element.monto | currency : '₡' : 'symbol' : '1.0-0' }}
        </span>
      </td>
    </ng-container>

    <!-- Fecha -->
    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let element">
        {{ element.created_at | date : 'dd/MM/yyyy HH:mm' }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr (click)="mostrar(row)" mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[10, 5, 20]" showFirstLastButtons> </mat-paginator>
</div>
